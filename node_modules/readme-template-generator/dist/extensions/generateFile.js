"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var _utils = require('src/utils');















exports. default = (toolbox) => {
  toolbox.generateFile = async ({
    template,
    target,
    props,
    trim = true
  }) => {
    const {
      template: { generate },
      filesystem: { read, write }
    } = toolbox

    const trimFile = () => {
      let fileText = read(target)

      // Remove the whitespace at the beginning and end of the string
      fileText = fileText.trim()

      // Removes whitespace at the beginning and end of each line in the str
      fileText = fileText
        .split('\n')
        .map(line => line.trim())
        .join('\n')

      // Removes blank lines, starting from two or more
      fileText = fileText.replace(/[\r\n]{2,}/g, '\n\n')

      // create end blank line
      fileText += '\n'

      // replace temporary character to normal spaces
      fileText = _utils.replaceAll.call(void 0, fileText, '¨', ' ')

      write(target, fileText)
    }

    // replace spaces to temporary characters
    if (trim) {
      const propsContentsInArray = Object.entries(props)

      for (const content of propsContentsInArray) {
        props[content[0]] = _utils.replaceAll.call(void 0, content[1], ' ', '¨')
      }
    }

    await generate({ template, target, props })

    if (trim) trimFile()
  }
}
